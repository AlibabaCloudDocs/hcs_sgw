# 管理NFS共享 {#concept_108276_zh .task}

本文介绍如何在本地文件网关控制台上管理NFS共享，包括创建、删除、关闭、修改NFS共享等操作。

1.  已添加缓存，详情请参见[添加缓存](cn.zh-CN/本地控制台用户指南/文件网关/管理缓存.md#section_1fm_vtm_6a7)。
2.  已绑定云资源，详情请参见[绑定云资源](cn.zh-CN/本地控制台用户指南/文件网关/管理云资源.md#section_4tc_gc9_08v)。

NFS（Network File System，网络文件系统） 允许网络中的计算机之间通过TCP/IP网络共享资源。在NFS应用中，本地NFS客户端应用可以透明地读写位于远端NFS服务器上的文件，就像访问本地文件一样。

云存储网关作为NFS的服务器端提供文件共享服务。在使用时，您需要先在云存储网关上创建共享目录，并设置允许访问共享目录的客户端以及访问权限。

## 安装NFS客户端 {#section_his_qqa_hf7 .section}

在创建NFS共享前，需在客户机上安装NFS客户端。

1.  登录客户机。
2.  执行以下命令安装NFS客户端。 

    此处介绍Ubuntu操作系统和CentOS操作系统的安装命令，其它操作系统上的NFS客户端安装请参见NFS官方文档。

    -   如果您使用Ubuntu操作系统，运行以下命令。

        ``` {#codeblock_f1y_hse_8tc}
        apt-get install nfs-common
        ```

    -   如果您使用CentOS操作系统，运行以下命令。

        ``` {#codeblock_rm0_au1_dm5}
        yum install -y nfs-utils
        ```


## 创建NFS共享 {#section_rho_vip_65z .section}

1.  在浏览器中，输入`https://<文件网关IP地址>`访问本地文件网关控制台。
2.  输入用户名和密码，单击**确认**。
3.  选择**NFS**，单击**创建**。
4.  在创建NFS对话框中，完成如下配置，并单击**确认**。 

    |参数|说明|
    |--|--|
    |**共享名称**|NFS协议的虚拟挂载点。 NFSv4可以通过该名称直接挂载；NFSv3需要通过`showmount -e <网关IP地址>`获取挂载点。

 |
    |**读写客户端列表**|允许读写访问NFS网关的IP地址或网段。 例如192.168.10.10或192.168.0.0/24，允许输入多个IP地址或者网段。

 |
    |**只读客户端列表**|允许只读访问NFS网关的IP地址或网段。 例如192.168.10.10或192.168.0.0/24，允许输入多个IP地址或者网段。

 |
    |**用户映射**| 设置NFS客户端用户与NFS服务器用户之间的映射关系，仅当**协议**类型选择**NFS**时需要配置。

     -   none：NFS客户端用户不被映射为NFS服务器的nobody用户。
    -   root\_squash：限制root用户，当NFS客户端以root用户身份访问时，映射为NFS服务器的nobody用户。
    -   all\_squash：限制所有用户，无论NFS客户端以何种用户身份访问，均映射为NFS服务器的nobody用户。
    -   all\_anomnymous：限制所有用户，无论NFS客户端以何种用户身份访问，均映射为NFS服务器的匿名用户。
 |
    |**启用**|启用NFS共享。 如果您暂时不想使用该NFS共享，您可以选择**否**，关闭该NFS共享。

 |
    |**模式**|包括缓存模式和复制模式。     -   **复制模式**：所有数据都会保存两份拷贝，一份保存在本地缓存，另一份保存在OSS。
    -   **缓存模式**：本地缓存全量元数据和经常访问的用户数据。OSS侧保持全量数据。
 |
    |**反向同步**|将OSS上的元数据同步回本地。适用于网关容灾和数据恢复/共享场景。 **说明：** 反向同步会扫描Bucket下的所有对象，如果对象数量较多，会产生OSS API请求费用。具体费用，请参见[对象存储 OSS 详细价格信息](https://www.aliyun.com/price/product?spm=a2c4g.11186623.2.26.18277b55Ki5BVd#/oss/detail)中的请求费用。

 |
    |**加密类型**|包括**不加密**和**服务端加密**。 如果选择**服务端加密**，还需设置**密钥ID**。您可以在[密钥管理服务控制台](https://kms.console.aliyun.com/)中创建密钥，详情请参见[创建密钥](../cn.zh-CN/快速入门/管理密钥.md#section_yhn_otu_mvs)。

 开启OSS服务端加密后，允许用户自带密钥，目前支持从密钥管理服务中导入KMS密钥。

 开启服务端加密后，通过共享目录上云的文件会在OSS端自动利用KMS密钥进行加密。您可以通过Get Object API验证当前文件是否已经加密，如果返回的Header中x-oss-server-side-encryption字段值为KMS，x-oss-server-side-encryption-key-id字段值为密钥ID，则表示已加密。

 **说明：** 

    -   白名单用户才能使用此功能。
    -   在密钥管理服务控制台创建密钥时，需选择与OSS Bucket一样的区域。
 |
    |**Bucket名称**|选择已创建的Bucket。|
    |**子目录**|输入Bucket下的子目录。 子目录只支持英文和数字。

 **说明：** 从1.0.38版本开始支持将文件系统的根目录对接到OSS Bucket的某个子目录，便于用户做访问隔离。

子目录可以为OSS Bucket中已存在的目录也可以为OSS Bucket中还未创建的目录，创建共享完成后，将以该子目录为根目录，后续的文件和目录都会创建该目录下。

 |
    |**使用元数据盘**|使用元数据盘后，将数据盘与元数据盘分离，元数据盘用于存放共享文件夹元数据信息。     -   选择**是**，需选择对应的**元数据盘**和**数据盘**。
    -   选择**否**，需选择对应的**缓存硬盘**。
 **说明：** 白名单用户才能使用此功能。

 |
    |**忽略删除**|文件删除操作不同步至OSS防止误操作。OSS侧保持全量数据。|
    |**同步延迟**|设置**同步延迟**，在关闭文件会延迟一段时间再上传，防止频繁的本地修改操作造成OSS碎片。缺省值为5s，最大值120s。|
    |**最大写入速度**|允许的最大写入速度为1280MB/s。默认为0，表示不限制速度。|
    |**最大上传速度**|允许的最大上传速度为1280MB/s。默认为0，表示不限制速度。 **说明：** 在限制速度的情况下，最大上传速度不能小于最大写入速度。

 |
    |**碎片优化**|针对某些反复随机小IO读写的应用，启用此配置可提升性能，请根据场景谨慎选择。|
    |**上传优化**|实时缓存回收，适用于数据纯备份上云场景。|

5.  单击**确认**，完成共享的创建。

## 相关操作 {#section_0hr_5t5_0rr .section}

在NFS页面，您还可以进行如下配置。

|操作|说明|
|--|--|
|关闭NFS共享|在NFS页面中，单击页面左上角的关闭按钮，关闭NFS共享。 如果您想关闭单个NFS共享，可通过以下方式。

 在NFS页面中，找到目标NFS共享，单击**设置**，将**启动**选项设置为**否**。

 |
|删除NFS共享|在NFS页面中，找到目标NFS共享，单击**删除**，删除该NFS共享。 **说明：** 当所删除的NFS共享已在客户端挂载时，删除该NFS共享后，客户端卸载挂载点会有所延迟，在该延迟时间内如果您再次创建同样ID的NFS共享，则客户端原挂载点就不会被卸载。所以删除NFS共享后，请执行`df –h`命令，确认已成功卸载挂载点后再执行其它操作。

 |
|修改NFS共享|在NFS页面中，找到目标NFS共享，单击**设置**或**高级设置**，修改NFS共享。|

[访问NFS共享目录](../cn.zh-CN/本地控制台用户指南/文件网关/访问共享目录/访问NFS共享目录.md#)

