# 管理共享 {#concept_108256_zh .task}

本文介绍如何在云存储网关控制台上管理共享，包括创建共享、设置NFS共享、设置SMB共享、删除共享等操作。

1.  已创建云存储网关，详情请参见[创建文件网关](cn.zh-CN/云控制台用户指南/文件网关/管理文件网关.md#section_i9x_102_e8q)。
2.  已添加缓存，详情请参见[添加缓存](cn.zh-CN/云控制台用户指南/文件网关/管理缓存.md#section_eb7_jwy_n7b)。
3.  已创建OSS Bucket，详情请参见[创建存储空间](../../../../cn.zh-CN/快速入门/创建存储空间.md#)。

    **说明：** 目前文件网关支持标准（Standard）类型和低频访问（IA）类型的OSS Bucket。对于归档（Archive）类型的OSS Bucket，仅支持写操作，读操作需要先解冻。


## 创建共享 {#section_qgs_5th_jol .section}

1.  登录[云存储网关控制台](https://sgwnew.console.aliyun.com/)。
2.  选择目标文件网关所在的地域。
3.  在网关列表页面，找到并单击目标文件网关，进入操作页面。
4.  选择共享页签，单击**创建**。
5.  在**Bucket设置**页签中，完成如下配置并单击**下一步**。 

    |参数|说明|
    |--|--|
    |**允许跨域访问Bucket**|     -   选择**是**，可访问与云存储网关不同地域的Bucket。
    -   选择**否**，只能访问与云存储网关相同地域的Bucket。
 |
    |**Bucket区域**|选择Bucket区域。|
    |**Bucket名称**|选择已创建的Bucket或者输入Bucket下的子目录。 子目录只支持英文和数字。

 **说明：** 从1.0.38版本开始支持将文件系统的根目录对接到OSS Bucket的某个子目录，便于用户做访问隔离。

子目录可以为OSS Bucket中已存在的目录也可以为OSS Bucket中还未创建的目录，创建共享完成后，将以该子目录为根目录，后续的文件和目录都会创建该目录下。

 |
    |**加密**|包括**不加密**和**服务端加密**。 如果选择**服务端加密**，还需设置**密钥ID**。您可以在[密钥管理服务控制台](https://kms.console.aliyun.com/)[密钥管理服务控制台](partners-intl.console.aliyun.com/#/kms)中创建密钥，详情请参见[创建密钥](../../../../cn.zh-CN/快速入门/管理密钥.md#section_yhn_otu_mvs)。

 开启OSS服务端加密后，允许用户自带密钥，目前支持从密钥管理服务中导入KMS密钥。

 开启服务端加密后，通过共享目录上云的文件会在OSS端自动利用KMS密钥进行加密。您可以通过Get Object API验证当前文件是否已经加密，如果返回的Header中x-oss-server-side-encryption字段值为KMS，x-oss-server-side-encryption-key-id字段值为密钥ID，则表示已加密。

 **说明：** 

    -   白名单用户才能使用此功能。
    -   在密钥管理服务控制台创建密钥时，需选择与OSS Bucket一样的区域。
 |
    |**使用SSL连接Bucket**|如果选择**是**，则可通过SSL连接Bucket。|

6.  在**基本信息**页签中，完成如下配置并单击**下一步**。 

    |参数|说明|
    |--|--|
    |**共享名称**|NFS或者SMB的共享名称。如果选择**NFS**协议，则此共享名称也是NFS v4的虚拟路径。 不能以数字开头，不能超过32个字符，可以为英文或者数字。

 **说明：** 1.0.35之前版本，如果使用NFS v3协议，则该名称无效，需要使用showmount –e <挂载网关的IP\> 查看挂载路径进行挂载。

 |
    |**协议**|根据业务需求，选择NFS或者SMB。     -   NFS协议适用于在Linux系统中对挂载的OSS资源进行访问
    -   SMB协议适用于在Windows系统中对挂载的OSS资源进行访问。
 |
    |**缓存**|选择已创建的缓存盘。 **说明：** 5TB以下缓存盘，其20%的空间用于存放元数据；5TB以上的存储盘，1TB用于存放元数据。例如：创建40G的缓存盘，其实际可使用的缓存大小为32G。创建20TB的缓存盘，其实际可使用的缓存大小为19TB。

 |
    |**用户映射**| 设置NFS客户端用户与NFS服务器用户之间的映射关系，仅当**协议**类型选择**NFS**时需要配置。

     -   none：NFS客户端用户不被映射为NFS服务器的nobody用户。
    -   root\_squash：限制root用户，当NFS客户端以root用户身份访问时，映射为NFS服务器的nobody用户。
    -   all\_squash：限制所有用户，无论NFS客户端以何种用户身份访问，均映射为NFS服务器的nobody用户。
    -   all\_anomnymous：限制所有用户，无论NFS客户端以何种用户身份访问，均映射为NFS服务器的匿名用户。
 |
    |**高级设置**|勾选**高级设置**后，出现**高级设置**配置页。|

7.  在**高级设置**页签中，完成如下配置并单击**下一步**。 

    |参数|说明|
    |--|--|
    |**模式**|     -   **复制模式**：所有数据都会保存两份拷贝，一份保存在本地缓存，另一份保存在OSS。
    -   **缓存模式**：本地缓存全量元数据和经常访问的用户数据。OSS侧保持全量数据。
 |
    |**碎片优化**|针对某些反复随机小IO读写的应用，启用此配置可提升性能，请根据场景谨慎选择。|
    |**上传优化**|实时缓存回收，适用于数据纯备份上云场景。|
    |**反向同步**|将OSS上的元数据同步回本地。适用于网关容灾和数据恢复/共享场景。 **说明：** 反向同步会扫描Bucket下的所有对象，如果对象数量较多，会产生OSS API请求费用。具体费用，请参见[对象存储 OSS 详细价格信息](https://www.aliyun.com/price/product?spm=a2c4g.11186623.2.26.18277b55Ki5BVd#/oss/detail)中的请求费用。

 |
    |**反向同步时间间隔**|设置**反向同步**为**是**，可设置**反向同步时间间隔**。支持15s-36000s的反向同步间隔，缺省值为36000s。 **说明：** 如果Bucket内的对象比较多，建议反向同步间隔大于3600s，否则会由于反复扫描产生大量的OSS API的请求费用。

 |
    |**忽略删除**|文件删除操作不同步至OSS防止误操作。OSS侧保持全量数据。|
    |**同步延迟**|设置**同步延迟**，在关闭文件会延迟一段时间再上传，防止频繁的本地修改操作造成OSS碎片。缺省值为5s，最大值120s。|

8.  在**总结**页签中，确认信息无误后，单击**完成**。

## 设置NFS共享 {#section_uqy_a1l_bkx .section}

如果创建共享时选择**NFS**协议，则单击**设置**可设置NFS共享信息。

1.  在共享页面，找到目标共享，单击**设置**。
2.  在NFS共享设置对话框中，配置相关信息。 
    -   **用户映射**：设置NFS客户端用户与NFS服务器用户之间的映射关系。
        -   none：NFS客户端用户不被映射为NFS服务器的nobody用户。
        -   root\_squash：限制root用户，当NFS客户端以root用户身份访问时，映射为NFS服务器的nobody用户。
        -   all\_squash：限制所有用户，无论NFS客户端以何种用户身份访问，均映射为NFS服务器的nobody用户。
        -   all\_anomnymous：限制所有用户，无论NFS客户端以何种用户身份访问，均映射为NFS服务器的匿名用户。
    -   **读写客户端列表**：允许读写访问NFS网关的IP地址或网段。

        例如192.168.10.10或192.168.0.0/24，允许输入多个IP地址或者网段。

    -   **只读客户端列表**：允许只读访问NFS网关的IP地址或网段。

        例如192.168.10.10或192.168.0.0/24，允许输入多个IP地址或者网段。

    -   **最大写入速度**：允许的最大写入速度为1280MB/s。默认为0，表示不限制速度。
    -   **最大上传速度**：允许的最大上传速度为1280MB/s。默认为0，表示不限制速度。

        **说明：** 在限制速度的情况下，最大上传速度不能小于最大写入速度。


## 设置SMB共享 {#section_k8u_gd6_35p .section}

如果创建共享时选择**SMB**协议，则单击**设置**可设置SMB共享信息。

1.  在共享页面，找到目标共享，单击**设置**。
2.  在SMB共享设置对话框中，配置相关信息。 
    -   **可浏览**：可在邻居网络被发现。
    -   **读写权限用户**：允许读写访问SMB网关的用户列表。
    -   **只读权限用户**：允许只读访问SMB网关的用户列表。

        **说明：** 如果只读用户同时出现在读写用户列表中，该用户只有只读权限。

    -   **最大写入速度**：允许的最大写入速度为1280MB/。默认为0，表示不限制速度。
    -   **最大上传速度**：允许的最大上传速度为1280MB/。默认为0，表示不限制速度。

        **说明：** 在限制速度的情况下，最大上传速度不能小于最大写入速度。


## 其他操作 {#section_1dz_3of_uo5 .section}

在共享列表页面，您可以进行如下操作。

|操作|说明|
|--|--|
|修改高级设置|找到目标共享，单击**高级共享**，可修改高级设置。高级设置参数说明，请参见[创建共享](#section_qgs_5th_jol)。|
|删除共享|找到目标共享，单击**删除**，可删除共享。 **说明：** 

-   删除共享，不会删除OSS上的数据。
-   删除共享，不会释放缓存盘。
-   删除共享，不会删除缓存盘上的数据。
-   再次创建共享时需要重新绑定缓存盘和OSS Bucket。

 |
|重启NFS共享|单击**重启NFS共享**，可重启该网关下所有的NFS共享。|
|重启SMB共享|单击**重启SMB共享**，可重启该网关下所有的SMB共享。|
|隐藏任务|单击**隐藏任务**，可隐藏页面下方的任务列表。|

[访问共享目录](cn.zh-CN/云控制台用户指南/文件网关/访问共享目录/访问NFS共享目录.md#)

