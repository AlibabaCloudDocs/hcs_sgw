# 归档管理

通过设置OSS Bucket的生命周期规则和自动归档操作，实现文件网关中的文件自动归档。

-   已创建标准类型或低频访问类型的OSS Bucket，详情请参见[创建存储空间](/intl.zh-CN/快速入门/控制台快速入门/创建存储空间.md)。

    **说明：** 云存储网关支持标准（Standard）类型、低频访问（IA）类型和归档存储类型的OSS Bucket。

-   已创建共享。

    **说明：**

    -   只支持自动归档NFS协议文件网关中的文件。创建共享时，**协议**需配置为**NFS**。
    -   创建共享时，**归档支持**需配置为**是**。
    -   如果是云上文件网关，详情请参见[创建共享](/intl.zh-CN/云控制台用户指南/文件网关/管理共享.md)。
    -   如果是本地文件网关，详情请参见[管理NFS共享](/intl.zh-CN/本地控制台用户指南/文件网关/管理NFS共享.md)。

从1.0.44版本开始，支持文件网关中的文件自动归档存储到OSS Bucket。

对于标准类型或者低频访问类型OSS Bucket内的文件，文件网关提供了文件系统端配置自动归档文件，解冻归档文件，查询文件归档状态的功能，不需要跳转到OSS控制台针对某个文件进行生命周期管理。

**说明：** 自动归档文件时，需要先在OSS控制台设置生命周期规则，解冻归档文件或查询归档状态时，无需设置。

## 步骤一：设置生命周期规则

您可以通过生命周期规则来批量转换OSS Bucket内对象（Object）的存储类型。

1.  登录[OSS管理控制台](https://oss.console.aliyun.com/)。

2.  在左侧存储空间列表中，单击目标存储空间名称，进入该存储空间概览页面。

3.  单击**基础设置**页签，找到**生命周期**区域，单击**设置**。

4.  在生命周期页面，单击**创建规则**。

5.  在生命周期创建规则页面，配置如下参数。

    |参数|说明|
    |--|--|
    |**状态**|选择**启用**。|
    |**策略**|选择**配置到整个Bucket**，使生命周期规则应用到整个存储空间。 **说明：** 选择**配置到整个Bucket**只允许配置一条生命周期规则。 |
    |**标签**|勾选**标签**并配置正确的标签，可以让规则针对拥有指定标签的对象生效。     -   **键**设置为**AutoArchive**。
    -   **值**设置为**enabled**。 |
    |**文件过期策略**|设置文件过期时间，选择**过期天数**或**过期日期**。|
    |转换到归档存储|勾选**转换到归档存储**并设置过期天数或过期日期。本文以设置过期天数1天为例。     -   过期天数：指定一个过期天数N。对象会在其最后修改时间的N天后过期，并执行归档操作。例如设置为1天后归档，最后修改日期为2019-10-1的对象会在2019年10月2号被后端程序扫描转换为归档存储。

**说明：** 存储类型转换后的计量计费规则，请参见[生命周期规则介绍](/intl.zh-CN/开发指南/对象/文件（Object）/文件生命周期/生命周期规则介绍.md)。

    -   过期日期：指定一个过期日期，最后修改时间在该日期之前的对象全部过期，并执行归档操作。例如设置为2019-10-1归档，最后修改日期为2019-10-1之前的对象会被后端程序扫描转换为归档存储。 |

6.  单击**确定**。

    **说明：**

    -   生命周期规则配置完成后即会被执行，请确认无误后再保存规则。
    -   更多关于生命周期规则的介绍请参见[生命周期规则介绍](/intl.zh-CN/开发指南/对象/文件（Object）/文件生命周期/生命周期规则介绍.md)。

## 步骤二：归档管理配置

1.  登录主机（Linux系统）。

2.  获取网关归档管理工具[sgw\_archive\_util](http://gosspublic.alicdn.com/sgw/sgw_archive_util)。

3.  添加网关归档管理工具的执行权限。

    ```
    sudo chmod a+x sgw_archive_util
    ```

4.  使用归档管理工具，自动归档文件。

    ```
    sgw_archive_util –a /path/file
    ```

    /path/file为本地文件的绝对路径，请根据实际情况替换。

5.  执行以下命令，验证归档结果。

    ```
    ossutil object-tagging --method get oss://file-wanqp/0816/0.txt
    ```

    oss://file-wanqp/0816/0.txt为文件在OSS Bucket的路径，请根据实际情况替换。

    在[步骤一：设置生命周期规则](#section_0aj_7nv_2y3)中以设置过期天数1天为例，所以1天后，文件将自动归档存储。

    如果显示如下信息，则表示自动归档成功。

    ![验证结果](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/1195891751/p61570.png)


## 相关操作

-   使用归档管理工具，自动解冻文件。

    ```
    sgw_archive_util -r /path/file
    ```

    /path/file为本地文件的绝对路径，请根据实际情况替换。

-   使用归档管理工具，查询归档状态。

    ```
    sgw_archive_util -q /path/file
    ```

    /path/file为本地文件的绝对路径，请根据实际情况替换。


